
public interface Expression {

    int evaluate(int x);
}

/**
 * Константа
 */
public class Const implements Expression {
    private final int value;
    
    public Const(int value) {
        this.value = value;
    }
    
    @Override
    public int evaluate(int x) {
        return value;
    }
    
    @Override
    public String toString() {
        return Integer.toString(value);
    }
}

/**
 * Переменная
 */
public class Variable implements Expression {
    private final String name;
    
    public Variable(String name) {
        this.name = name;
    }
    
    @Override
    public int evaluate(int x) {
        return x; // На данном этапе имя игнорируется
    }
    
    @Override
    public String toString() {
        return name;
    }
}

/**
 * Абстрактный класс для бинарных операций
 */
public abstract class BinaryOperation implements Expression {
    protected final Expression left;
    protected final Expression right;
    
    public BinaryOperation(Expression left, Expression right) {
        this.left = left;
        this.right = right;
    }
    
    protected abstract int apply(int left, int right);
    protected abstract String getOperator();
    
    @Override
    public int evaluate(int x) {
        return apply(left.evaluate(x), right.evaluate(x));
    }
    
    @Override
    public String toString() {
        return "(" + left + " " + getOperator() + " " + right + ")";
    }
}

/**
 * Сложение
 */
public class Add extends BinaryOperation {
    public Add(Expression left, Expression right) {
        super(left, right);
    }
    
    @Override
    protected int apply(int left, int right) {
        return left + right;
    }
    
    @Override
    protected String getOperator() {
        return "+";
    }
}

/**
 * Вычитание
 */
public class Subtract extends BinaryOperation {
    public Subtract(Expression left, Expression right) {
        super(left, right);
    }
    
    @Override
    protected int apply(int left, int right) {
        return left - right;
    }
    
    @Override
    protected String getOperator() {
        return "-";
    }
}

/**
 * Умножение
 */
public class Multiply extends BinaryOperation {
    public Multiply(Expression left, Expression right) {
        super(left, right);
    }
    
    @Override
    protected int apply(int left, int right) {
        return left * right;
    }
    
    @Override
    protected String getOperator() {
        return "*";
    }
}

/**
 * Деление
 */
public class Divide extends BinaryOperation {
    public Divide(Expression left, Expression right) {
        super(left, right);
    }
    
    @Override
    protected int apply(int left, int right) {
        if (right == 0) {
            throw new ArithmeticException("Division by zero");
        }
        return left / right;
    }
    
    @Override
    protected String getOperator() {
        return "/";
    }
}
